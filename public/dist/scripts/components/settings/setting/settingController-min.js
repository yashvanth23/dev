+function(t,e){"use strict";function o(o,a,n,s,i,r,l){function f(t){if(alert("wewew"),console.log(t),t.files&&t.files[0]){var a=new FileReader;a.onload=function(a){o.file=t.files[0],e.element("#proPic").css({"background-image":"url("+a.target.result+")"}),o.picture=a.target.result,o.profileInfo.avatar=a.target.result,o.profileUpload=!0},a.readAsDataURL(t.files[0])}}o.initFunction=function(){o.userData=JSON.parse(t.sessionStorage.userDetail),o.settingDrop=!1,o.genderError=!1,o.profileEdit=!1,o.changePass={oldPass:"",newPass:""},a.loader=!0,o.profileInfo={name:"",email:"",notification:!1,mobile:"",gender:"",address:"",city:"",state:"",pincode:"",country:"",avatar:""},o.file="",o.userData.social_auth?null!=o.userData.facebook.social_id?o.profileInfo.avatar=o.userData.facebook.profile:o.profileInfo.avatar=o.userData.google.imgUrl:o.profileInfo.avatar=o.userData.avatar,o.profileUpload=!1,o.customError=!1,o.getProfileInformation()},o.getProfileInformation=function(){var t=a.appConfig.baseUrl+a.appConfig.profile+"/"+o.userData._id;i.get(t).then(function(t){a.loader=!1,t&&"success"==t.data.status?(o.profile=t.data.data,o.profileInfo.name=o.profile.name,o.profileInfo.email=o.profile.email,o.profileInfo.mobile=o.profile.mobileNumber,o.profileInfo.gender=o.profile.gender,o.profileInfo.address=o.profile.address.line1,o.profileInfo.city=o.profile.address.city,o.profileInfo.state=o.profile.address.state,o.profileInfo.pincode=o.profile.address.pincode,o.profileInfo.country=o.profile.address.country,o.profileInfo.notification=o.profile.pushNotification):(o.toastContent=$("<span>"+t.data.error+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3))},function(t){o.toastContent=$("<span>"+t+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3)})},o.updateProfile=function(t){o.submitForm=!0;var e=!1;if(""==o.profileInfo.gender?(o.genderError=!0,e=!1):void 0==o.profileInfo.gender?(o.genderError=!0,e=!1):(o.genderError=!1,e=!0),t&&e){a.loader=!0;var s=a.appConfig.baseUrl+a.appConfig.updateProfile,r={_id:o.userData._id,name:o.profileInfo.name,gender:o.profileInfo.gender,mobileNumber:o.profileInfo.mobile,address:{line1:o.profileInfo.address,city:o.profileInfo.city,state:o.profileInfo.state,pincode:o.profileInfo.pincode,country:o.profileInfo.country},pushNotification:o.profileInfo.notification};i.post(s,r).then(function(t){a.loader=!1,t&&"success"==t.data.status?(o.profile=t.data.data,o.submitForm=!1,n.showError("#successModal","Profile Updated Successfully",!0),o.getProfileInformation(),o.enableProfile()):(o.toastContent=$("<span>"+t.data.error+"</span>").add($('<button class="btn-flat toast-action">OK</button>')),Materialize.toast(o.toastContent,3e3))},function(t){o.toastContent=$("<span>"+t+"</span>").add($('<button class="btn-flat toast-action">OK</button>')),Materialize.toast(o.toastContent,3e3)})}},o.changePasswordOpen=function(){e.element(".setting-modal").addClass("active"),o.settingDrop=!0},o.changePasswordClose=function(){e.element(".setting-modal").removeClass("active"),o.settingDrop=!1},o.uploadAvatar=function(t){if(""!=o.file){var e=a.appConfig.baseUrl+a.appConfig.uploadProfileImage,s=[];s.push(o.file);var r={file:s,username:o.userData.username,type:"image",viewport:"desktop"};console.log(r),i.post(e,r).then(function(t){a.loader=!1,t&&"success"==t.data.status?(n.showSuccess("#successModal","Profile Picture Uploaded Successfully",!0),o.profileUpload=!1):(o.toastContent=$("<span>"+t.data.error+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3))},function(t){o.toastContent=$("<span>"+t+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3)})}else o.toastContent=$("<span> Please Upload Profile Picture</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3)},o.addProfile=function(){o.profileEdit&&document.getElementById("avatar").click()},$("#avatar").change(function(){f(this)}),o.onLoad=function(t,e,a,s,i,l){try{"unsupported"==t?n.showError("Sorry, the uploaded file type is not supported. Please choose a JPEG (or) PNG type image."):l&&l.filetype&&"image"==l.filetype.split("/")[0]&&(alert(o.profilePic),o.file=o.profilePic,o.picture=l.base64,o.profileBase=l.base64,o.profileInfo.avatar=o.profileBase,o.profileUpload=!0)}catch(t){r.promiseRejectsAfterAWhile(t)}},o.changePassword=function(t){if(o.passwordChange=!0,t){a.loader=!0;var e=a.appConfig.baseUrl+a.appConfig.changePassword,s={username:o.userData.username,oldPassword:o.changePass.oldPass,newPassword:o.changePass.newPass};i.post(e,s).then(function(t){a.loader=!1,t&&"success"==t.data.status?(o.passwordChange=!1,console.log(t.data.data),n.showSuccess("#successModal","Password Changed Successfully",!0)):(o.toastContent=$("<span>"+t.data.error+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3))},function(t){o.toastContent=$("<span>"+t+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(o.toastContent,3e3)})}},o.enableProfile=function(){o.profileEdit?(o.profileEdit=!1,e.element(".setting-profile").removeClass("edit")):(o.profileEdit=!0,e.element(".setting-profile").addClass("edit"))},o.initFunction()}e.module("fantumn").registerCtrl("settingCtrl",o),o.$inject=["$scope","$rootScope","$commons","$logger","fantumnService","exceptionService","$http"]}(window,angular);