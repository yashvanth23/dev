+function(e,o){"use strict";function t(t,a,r,i,n,s,l){if(void 0!=e.sessionStorage.userDetail)if(""!=e.sessionStorage.userDetail){t.initFunction=function(){t.userData=JSON.parse(e.sessionStorage.userDetail),t.settingDrop=!1,t.genderError=!1,t.profileEdit=!1,t.changePass={oldPass:"",newPass:""},a.loader=!0,t.profileInfo={name:"",email:"",notification:!1,mobile:"",gender:"",dob:"",address:"",city:"",state:"",pincode:"",country:"",avatar:""},t.file="",t.userData.social_auth?null!=t.userData.facebook.social_id?t.profileInfo.avatar=t.userData.facebook.profile:t.profileInfo.avatar=t.userData.google.imgUrl:t.profileInfo.avatar=t.userData.avatar,t.profileUpload=!1,t.customError=!1,t.getProfileInformation()},t.getProfileInformation=function(){var e=a.appConfig.baseUrl+a.appConfig.profile+"/"+t.userData._id,o=a.appConfig.baseUrl+a.appConfig.user,r={_id:t.userData._id};n.get(e).then(function(e){a.loader=!1,e&&"success"==e.data.status?(t.profile=e.data.data,t.profileInfo.name=t.profile.firstName,t.profileInfo.lastname=t.profile.firstName,t.profileInfo.mobile=t.profile.mobileNumber,t.profileInfo.gender=t.profile.gender,t.profileInfo.dob=t.profile.dob,t.profileInfo.address=t.profile.address.line1,t.profileInfo.city=t.profile.address.city,t.profileInfo.state=t.profile.address.state,t.profileInfo.pincode=t.profile.address.pincode,t.profileInfo.country=t.profile.address.country,t.profileInfo.notification=t.profile.pushNotification):(t.toastContent=e.data.error,Materialize.toast(t.toastContent,1500,"rounded"))},function(e){t.toastContent=e,Materialize.toast(t.toastContent,1500)}),n.post(o,r).then(function(e){t.profile1=e.data.data,t.profileInfo.email=t.profile1.email})},t.updateProfile=function(e){t.submitForm=!0;var o=!1;if(""==t.profileInfo.gender?(t.genderError=!0,o=!1):void 0==t.profileInfo.gender?(t.genderError=!0,o=!1):(t.genderError=!1,o=!0),e&&o){a.loader=!0;var i=a.appConfig.baseUrl+a.appConfig.updateProfile,s={_id:t.userData._id,fistName:t.profileInfo.name,lastName:t.profileInfo.lastname,gender:t.profileInfo.gender,dob:Date.now(t.profileInfo.dob),mobileNumber:t.profileInfo.mobile,address:{line1:t.profileInfo.address,city:t.profileInfo.city,state:t.profileInfo.state,pincode:t.profileInfo.pincode,country:t.profileInfo.country},pushNotification:t.profileInfo.notification};n.post(i,s).then(function(e){a.loader=!1,e&&"success"==e.data.status?(t.profile=e.data.data,t.submitForm=!1,r.showError("#successModal","Profile Updated Successfully",!0),t.getProfileInformation(),t.enableProfile()):(t.toastContent=e.data.error,Materialize.toast(t.toastContent,1500,"rounded"))},function(e){t.toastContent=e,Materialize.toast(t.toastContent,1500,"rounded")})}},t.changePasswordOpen=function(){o.element(".setting-modal").addClass("active"),t.settingDrop=!0},t.changePasswordClose=function(){o.element(".setting-modal").removeClass("active"),t.settingDrop=!1},t.uploadAvatar=function(e){if(""!=t.file){var o=a.appConfig.baseUrl+a.appConfig.uploadProfileImage,i=[];i.push(t.file);var s={file:i,username:t.userData.username,type:"image",viewport:"desktop"};console.log(s),n.post(o,s).then(function(e){a.loader=!1,e&&"success"==e.data.status?(r.showSuccess("#successModal","Profile Picture Uploaded Successfully",!0),t.profileUpload=!1):(t.toastContent=e.data.error,Materialize.toast(t.toastContent,1500,"rounded"))},function(e){t.toastContent=$("<span>"+e+"</span>").add($('<button class="btn-flat toast-action"  >OK</button>')),Materialize.toast(t.toastContent,1500,"rounded")})}else t.toastContent="Please Upload Profile Picture",Materialize.toast(t.toastContent,1500,"rounded")},t.addProfile=function(){t.profileEdit&&document.getElementById("avatar").click()},$("#avatar").change(function(){f(this)});function f(e){if(alert("wewew"),console.log(e),e.files&&e.files[0]){var a=new FileReader;a.onload=function(a){t.file=e.files[0],o.element("#proPic").css({"background-image":"url("+a.target.result+")"}),t.picture=a.target.result,t.profileInfo.avatar=a.target.result,t.profileUpload=!0},a.readAsDataURL(e.files[0])}}t.onLoad=function(e,o,a,i,n,l){try{"unsupported"==e?r.showError("Sorry, the uploaded file type is not supported. Please choose a JPEG (or) PNG type image."):l&&l.filetype&&"image"==l.filetype.split("/")[0]&&(alert(t.profilePic),t.file=t.profilePic,t.picture=l.base64,t.profileBase=l.base64,t.profileInfo.avatar=t.profileBase,t.profileUpload=!0)}catch(e){s.promiseRejectsAfterAWhile(e)}},t.changePassword=function(e){if(t.passwordChange=!0,e){a.loader=!0;var o=a.appConfig.baseUrl+a.appConfig.changePassword,i={username:t.userData.username,oldPassword:t.changePass.oldPass,newPassword:t.changePass.newPass};n.post(o,i).then(function(e){a.loader=!1,e&&"success"==e.data.status?(t.passwordChange=!1,console.log(e.data.data),r.showSuccess("#successModal","Password Changed Successfully",!0)):(t.toastContent=e.data.error,Materialize.toast(t.toastContent,1500,"rounded"))},function(e){t.toastContent=e,Materialize.toast(t.toastContent,1500,"rounded")})}},t.enableProfile=function(){t.profileEdit?(t.profileEdit=!1,o.element(".setting-profile").removeClass("edit")):(t.profileEdit=!0,o.element(".setting-profile").addClass("edit"))},t.initFunction()}else r.navigate("layout.dashboard","",!1);else r.navigate("layout.dashboard","",!1)}o.module("fantumn").registerCtrl("settingCtrl",t),t.$inject=["$scope","$rootScope","$commons","$logger","fantumnService","exceptionService","$http"]}(window,angular);