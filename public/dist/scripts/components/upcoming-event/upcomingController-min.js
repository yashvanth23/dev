+function(e,a){"use strict";function s(s,t,i,l,r,n,o,p,y,d){function m(e,a){for(var t=0;t<e.length;t++)for(var i=0;i<a.length;i++)e[t].id===a[i].playerId&&e[t].id===a[i].playerId&&(s.allPlayers[t].status=!0);return s.allPlayers}s.initFunction=function(){s.matchDetails=JSON.parse(e.sessionStorage.match),s.userDetailInfo=JSON.parse(e.sessionStorage.userDetail),s.countdown=s.matchDetails.starts,s.home={id:s.matchDetails.teams.team1.teamId,name:s.matchDetails.teams.team1.name},s.away={id:s.matchDetails.teams.team2.teamId,name:s.matchDetails.teams.team2.name},s.playerTab="all",s.playType={def:!0,mid:!0,fk:!0,gk:!0},s.goalKeep=1,s.defPlayer=1,s.midPlayer=1,s.fwdPlayer=1,s.userInfo=JSON.parse(e.sessionStorage.userDetail),s.playerList=[],s.reviewList=[],s.teamJerSey=[{teamId:"52",jersey:"assets/images/jersey/AFC_Bournemouth.png",position:"all"},{teamId:"19",jersey:"assets/images/jersey/Arsenal.png",position:"all"},{teamId:"78",jersey:"assets/images/jersey/Brighton&_Hove_Albion.png",position:"all"},{teamId:"27",jersey:"assets/images/jersey/Burnley.png",position:"all"},{teamId:"18",jersey:"assets/images/jersey/Chelsea.png",position:"all"},{teamId:"51",jersey:"assets/images/jersey/Crystal_Palace.png",position:"all"},{teamId:"13",jersey:"assets/images/jersey/Everton.png",position:"all"},{teamId:"251",jersey:"assets/images/jersey/Huddersfield_Town.png",position:"all"},{teamId:"42",jersey:"assets/images/jersey/Leicester_City.png",position:"all"},{teamId:"8",jersey:"assets/images/jersey/Liverpool.png",position:"all"},{teamId:"9",jersey:"assets/images/jersey/Manchester_City.png",position:"all"},{teamId:"14",jersey:"assets/images/jersey/Manchester_United.png",position:"all"},{teamId:"20",jersey:"assets/images/jersey/Newcastle_United.png",position:"all"},{teamId:"65",jersey:"assets/images/jersey/Southampton.png",position:"all"},{teamId:"26",jersey:"assets/images/jersey/Stoke_City.png",position:"all"},{teamId:"30",jersey:"assets/images/jersey/Swansea_City.png",position:"all"},{teamId:"6",jersey:"assets/images/jersey/Tottenham_Hotspur.png",position:"all"},{teamId:"25",jersey:"assets/images/jersey/Watford.png",position:"all"},{teamId:"10",jersey:"assets/images/jersey/West_Bromwich_Albion.png",position:"all"},{teamId:"1",jersey:"assets/images/jersey/West_Ham_United.png",position:"all"}],s.goalKeeJersey=[{teamId:"52",jersey:"assets/images/jersey/keeper/afc.png",position:"GK"},{teamId:"19",jersey:"assets/images/jersey/keeper/Arsenal.png",position:"GK"},{teamId:"78",jersey:"assets/images/jersey/keeper/Brighton_Hove_Albion.png",position:"GK"},{teamId:"27",jersey:"assets/images/jersey/keeper/Burnley.png",position:"GK"},{teamId:"18",jersey:"assets/images/jersey/keeper/Chelsea.png",position:"GK"},{teamId:"51",jersey:"assets/images/jersey/keeper/Crystal_Palace.png",position:"GK"},{teamId:"13",jersey:"assets/images/jersey/keeper/Everton.png",position:"GK"},{teamId:"251",jersey:"assets/images/jersey/keeper/Huddersfield_Town.png",position:"GK"},{teamId:"42",jersey:"assets/images/jersey/keeper/Leicester.png",position:"GK"},{teamId:"8",jersey:"assets/images/jersey/keeper/Liverpool.png",position:"GK"},{teamId:"9",jersey:"assets/images/jersey/keeper/Manchester_City.png",position:"GK"},{teamId:"14",jersey:"assets/images/jersey/keeper/Manchester_United.png",position:"GK"},{teamId:"20",jersey:"assets/images/jersey/keeper/Newcastle.png",position:"GK"},{teamId:"65",jersey:"assets/images/jersey/keeper/Southampton.png",position:"GK"},{teamId:"26",jersey:"assets/images/jersey/keeper/Stoke_City.png",position:"GK"},{teamId:"30",jersey:"assets/images/jersey/keeper/Swansea_City.png",position:"GK"},{teamId:"6",jersey:"assets/images/jersey/keeper/Tottenham_Hotspur.png",position:"GK"},{teamId:"25",jersey:"assets/images/jersey/keeper/Watford.png",position:"GK"},{teamId:"10",jersey:"assets/images/jersey/keeper/West_Bromwich.png",position:"GK"},{teamId:"1",jersey:"assets/images/jersey/keeper/West_Ham_United.png",position:"GK"}],s.review=!1,s.matchDetails.picked?s.getLeaderBoard():s.getPlayers()},s.getPlayers=function(){try{var e=t.appConfig.baseUrl+t.appConfig.getPlayers+"/"+s.matchDetails.matchId;r.get(e).then(function(e){if(e&&"success"==e.data.status){s.allPlayers=e.data.data.all;for(var i=0;i<s.allPlayers.length;i++)for(var l=0;l<s.matchDetails.match.lineup.length;l++)s.allPlayers[i].status=!1,s.allPlayers[i].id==s.matchDetails.match.lineup[l].playerId&&(s.allPlayers[i].points={totalPoints:s.matchDetails.match.lineup[l].points,minutesPlayed:s.matchDetails.match.lineup[l].minutesPlayed},1==s.allPlayers[i].position?s.allPlayers[i].positionPlay="GK":2==s.allPlayers[i].position?s.allPlayers[i].positionPlay="DEF":3==s.allPlayers[i].position?s.allPlayers[i].positionPlay="MID":s.allPlayers[i].positionPlay="FW");t.loader=!1,s.matchStatus=!1,s.allPlayers.length>=9?a.element(".allplay").addClass("cus-scroll"):a.element(".allplay").removeClass("cus-scroll"),s.forwardPlayers=e.data.data.fwd,s.defendPlayers=e.data.data.def,s.goalKeeperPlayers=e.data.data.gk,s.midPlayers=e.data.data.mid}else s.historyMatch=e.data.error},function(e){i.showError("#errorModal","Something Went Wrong",!0)})}catch(e){n.promiseRejectsAfterAWhile(e)}},s.getLeaderBoard=function(){t.loader=!0;var e=t.appConfig.baseUrl+t.appConfig.rosterPlayer+"/"+s.userDetailInfo._id+"/"+s.matchDetails.matchId,i=t.appConfig.baseUrl+t.appConfig.getPlayers+"/"+s.matchDetails.matchId,l="",n="";y.all([l=r.get(e),n=r.get(i)]).then(function(){l.then(function(e){if(e&&"success"==e.data.status){s.allLineup=e.data.data.match.lineup,s.matchInfo=e.data.data.players,s.playerList=[],s.reviewList=[];for(var a=0;a<s.matchInfo.length;a++)for(var t=0;t<s.allLineup.length;t++)s.allLineup[t].playerId==s.matchInfo[a].playerId&&(s.playerList.push({colorCode:"",iconId:"",playerId:s.matchInfo[a].playerId,id:s.matchInfo[a].playerId,name:s.matchInfo[a].name,positionId:s.matchInfo[a].positionId,position:s.matchInfo[a].position,teamId:s.allLineup[t].teamId,status:!0}),s.reviewList.push({colorCode:"",iconId:"",playerId:s.matchInfo[a].playerId,name:s.matchInfo[a].name,positionId:s.matchInfo[a].positionId,position:s.matchInfo[a].position,teamId:s.allLineup[t].teamId,status:!0}),1==s.playerList[a].positionId?(s.reviewList[a].positionPlay="GK",s.playerList[a].positionPlay="GK"):2==s.playerList[a].positionId?(s.reviewList[a].positionPlay="DEF",s.playerList[a].positionPlay="DEF"):3==s.playerList[a].positionId?(s.reviewList[a].positionPlay="MID",s.playerList[a].positionPlay="MID"):(s.reviewList[a].positionPlay="FW",s.playerList[a].positionPlay="FW"))}s.matchStatus=!0,s.goalKeep=1,s.defPlayer=4,s.midPlayer=3,s.fwdPlayer=3;for(var i=0;i<s.reviewList.length;i++)if("GK"===s.reviewList[i].positionPlay)for(var l=0;l<s.goalKeeJersey.length;l++)s.reviewList[i].teamId==s.goalKeeJersey[l].teamId&&(s.reviewList[i].image=s.goalKeeJersey[l].jersey);else for(var r=0;r<s.teamJerSey.length;r++)s.reviewList[i].teamId==s.teamJerSey[r].teamId&&(s.reviewList[i].image=s.teamJerSey[r].jersey)}),n.then(function(e){if(e&&"success"==e.data.status){s.allPlayers=e.data.data.all,t.loader=!1;for(var i=0;i<s.allPlayers.length;i++)for(var l=0;l<s.matchDetails.match.lineup.length;l++)s.allPlayers[i].id==s.matchDetails.match.lineup[l].playerId&&(s.allPlayers[i].points={totalPoints:s.matchDetails.match.lineup[l].points,minutesPlayed:s.matchDetails.match.lineup[l].minutesPlayed},s.allPlayers.length>=9?a.element(".allplay").addClass("cus-scroll"):a.element(".allplay").removeClass("cus-scroll"),1==s.allPlayers[i].position?s.allPlayers[i].positionPlay="GK":2==s.allPlayers[i].position?s.allPlayers[i].positionPlay="DEF":3==s.allPlayers[i].position?s.allPlayers[i].positionPlay="MID":s.allPlayers[i].positionPlay="FW");m(s.allPlayers,s.playerList)}})})},s.navigateTab=function(e){try{s.playerTab=e}catch(e){n.promiseRejectsAfterAWhile(e)}},s.navigateActiveTab=function(e){return s.playerTab===e},s.slider=function(e){"prev"===e?"all"===s.playerTab?s.navigateTab("gk"):"def"===s.playerTab?s.navigateTab("all"):"mid"===s.playerTab?s.navigateTab("def"):"fk"===s.playerTab?s.navigateTab("mid"):"gk"===s.playerTab&&s.navigateTab("fk"):"all"===s.playerTab?s.navigateTab("def"):"def"===s.playerTab?s.navigateTab("mid"):"mid"===s.playerTab?s.navigateTab("fk"):"fk"===s.playerTab?s.navigateTab("gk"):"gk"===s.playerTab&&s.navigateTab("all")},s.addPlayer=function(e,a,t){var l=[],r=[],n=[];if(e.status){for(var o=0;o<s.allPlayers.length;o++)e.id==s.allPlayers[o].id&&(s.allPlayers[o].status=!1);1==e.position?s.goalKeep--:2==e.position?s.defPlayer--:3==e.position?s.midPlayer--:s.fwdPlayer--;for(var p=0;p<s.playerList.length;p++)s.playerList[p].id==e.id&&(s.playerList.splice(p,1),s.reviewList.splice(p,1))}else if(s.playerList.length<11)if("1"===e.position)1==s.goalKeep?(s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id),s.goalKeep++):i.showWarning("#warningModal","Already Selected One Goal Keeper",!0);else if("2"===e.position)if(s.defPlayer<=4){if(4==s.defPlayer){for(var y=0;y<s.playerList.length;y++)"2"==s.playerList[y].position&&e.teamId==s.playerList[y].teamId&&l.push(s.playerList[y].teamId);3==l.length?(s.defPlayer--,i.showWarning("#warningModal","Cannot Select 4 Defenders Same Team",!0)):(s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id))}else s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id);s.defPlayer++}else i.showWarning("#warningModal","Already Selected 4 Defenders",!0);else if("3"===e.position)if(s.midPlayer<=3){if(3==s.midPlayer){for(var d=0;d<s.playerList.length;d++)"3"==s.playerList[d].position&&e.teamId==s.playerList[d].teamId&&r.push(s.playerList[d].teamId);2==r.length?(s.midPlayer--,i.showWarning("#warningModal","Cannot Select 3 MidFielders Same Team",!0)):(s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id))}else s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id);s.midPlayer++}else i.showWarning("#warningModal","Already Selected 3 Midfielders",!0);else if(s.fwdPlayer<=3){if(3==s.fwdPlayer){for(var m=0;m<s.playerList.length;m++)"4"==s.playerList[m].position&&e.teamId==s.playerList[m].teamId&&n.push(s.playerList[m].teamId);2==n.length?(s.fwdPlayer--,i.showWarning("#warningModal","Cannot Select 3 Forward Players Same Team",!0)):(s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id))}else s.playerList.push(e),s.reviewPush(e),s.findStatus(e.id);s.fwdPlayer++}else i.showWarning("#warningModal","Already Selected 3 Midfielders",!0);else i.showWarning("#warningModal","Already Selected 11 Players",!0)},s.addTeam=function(){if(11==s.playerList.length){t.loader=!0;for(var e=t.appConfig.baseUrl+t.appConfig.createMatch,a=[],l=0;l<s.playerList.length;l++)a.push(s.playerList[l].id);var n={username:s.userInfo.username,matchId:s.matchDetails.matchId,players:a};r.post(e,n).then(function(e){e&&"success"==e.data.status&&(t.loader=!1,""==e.data.error?(s.getUpcomingMatch(),s.matchStatus?i.showSuccess("#successModal","Successfully Update team !",!0):(i.showSuccess("#successModal","Successfully Create New team !",!0),s.matchStatus=!0),s.matchStatus=!0):i.showError("#errorModal",e.data.error,!0))},function(e){i.showError("#errorModal",e,!0)})}else i.showWarning("#warningModal","Please 11 Players in Team",!0)},s.findStatus=function(e){for(var a=0;a<s.allPlayers.length;a++)e==s.allPlayers[a].id&&(s.allPlayers[a].status=!0)},s.reviewPush=function(e){if("GK"===e.positionPlay)for(var a=0;a<s.goalKeeJersey.length;a++)e.teamId==s.goalKeeJersey[a].teamId&&(s.reviewList.push(e),s.reviewList[s.reviewList.length-1].image=s.goalKeeJersey[a].jersey);else for(var t=0;t<s.teamJerSey.length;t++)e.teamId==s.teamJerSey[t].teamId&&(s.reviewList.push(e),s.reviewList[s.reviewList.length-1].image=s.teamJerSey[t].jersey);return s.reviewList},s.reviewTeam=function(){s.review=!0,s.defReview=p("filter")(s.reviewList,"DEF"),s.midReview=p("filter")(s.reviewList,"MID"),s.fwReview=p("filter")(s.reviewList,"FW"),s.gkReview=p("filter")(s.reviewList,"GK"),console.log(s.defReview)},s.reviewClose=function(){s.review=!1},s.socialShare=function(e){var t=a.element("#snapshot");t.css({display:"block"});var i;html2canvas(t,{onrendered:function(a){$("#img-out").append(a);var l=(i=a).toDataURL("image/png");if($("#img-out").html(""),"facebook"===e){var r='<meta og:image content="'+l+'"/>';$("#fbShare").attr("socialshare-text","My Fantumn XI line up for the match. Match details"+s.matchDetails.home+" VS "+s.matchDetails.away),$("#fbShare").attr("socialshare-media",r),$("#fbShare").attr("socialshare-url","http://www.fantumn.com"),document.getElementById("fbShare").click()}else"twitter"===e?($("#twitterShare").attr("socialshare-text","My Fantumn XI line up for the match. Match details"+s.matchDetails.home+" VS "+s.matchDetails.away),$("#twitterShare").attr("socialshare-url",l),document.getElementById("twitterShare").click()):"download"==e&&(s.downloaUri=l,$("#downloadPitch").attr("href",l),document.getElementById("downloadPitch").click(),$("#downloadPitch").attr("href",""));t.css({display:"none"})}})},s.$watch("matchChange",function(){e.sessionStorage.match!==s.matchDetails&&(s.matchDetails=JSON.parse(e.sessionStorage.match),s.countdown=s.matchDetails.starts,s.home={id:s.matchDetails.teams.team1.teamId,name:s.matchDetails.teams.team1.name},s.away={id:s.matchDetails.teams.team2.teamId,name:s.matchDetails.teams.team2.name},s.playerTab="all",s.goalKeep=1,s.defPlayer=1,s.midPlayer=1,s.fwdPlayer=1,s.playerList=[],s.reviewList=[],s.review=!1,s.matchDetails.picked?s.getLeaderBoard():s.getPlayers())}),s.initFunction()}a.module("fandom").registerCtrl("upcomingCtrl",s),s.$inject=["$scope","$rootScope","$commons","$logger","fandomService","exceptionService","$window","$filter","$q","Socialshare"]}(window,angular);