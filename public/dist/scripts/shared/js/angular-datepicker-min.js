!function(e,a){"use strict";var t=function(){if(a.userAgent&&(a.userAgent.match(/Android/i)||a.userAgent.match(/webOS/i)||a.userAgent.match(/iPhone/i)||a.userAgent.match(/iPad/i)||a.userAgent.match(/iPod/i)||a.userAgent.match(/BlackBerry/i)||a.userAgent.match(/Windows Phone/i)))return!0}();e.module("720kb.datepicker",[]).directive("datepicker",["$window","$compile","$locale","$filter","$interpolate","$timeout",function(a,n,i,r,d,l){return{restrict:"AEC",scope:{dateSet:"@",dateMinLimit:"@",dateMaxLimit:"@",dateMonthTitle:"@",dateYearTitle:"@",buttonNextTitle:"@",buttonPrevTitle:"@",dateDisabledDates:"@",dateEnabledDates:"@",dateDisabledWeekdays:"@",dateSetHidden:"@",dateTyper:"@",dateWeekStartDay:"@",datepickerAppendTo:"@",datepickerToggle:"@",datepickerClass:"@",datepickerShow:"@"},link:function(c,o,s){var m,u,b,h=s.selector,y=e.element(h?o[0].querySelector("."+h):o[0].children[0]),p=s.buttonPrev||'<b class="_720kb-datepicker-default-button">&lang;</b>',g=s.buttonNext||'<b class="_720kb-datepicker-default-button">&rang;</b>',M=s.dateFormat,k=c.$eval(c.dateDisabledDates),f=c.$eval(c.dateEnabledDates),D=c.$eval(c.dateDisabledWeekdays),v=new Date,N=!1,S=!1,w=void 0!==s.datepickerMobile&&"false"!==s.datepickerMobile,x=i.DATETIME_FORMATS,Y=function(e,a,n){var i=['<div class="_720kb-datepicker-calendar {{datepickerClass}} {{datepickerID}}" ng-class="{\'_720kb-datepicker-forced-to-open\': checkVisibility()}" ng-blur="hideCalendar()">',"</div>"],r=function(e,a,n){return n&&(t=!1),t?['<div class="_720kb-datepicker-calendar-header">','<div class="_720kb-datepicker-calendar-header-middle _720kb-datepicker-mobile-item _720kb-datepicker-calendar-month">','<select ng-model="month" title="{{ dateMonthTitle }}" ng-change="selectedMonthHandle(month)">','<option ng-repeat="item in months" ng-selected="item === month" ng-disabled=\'!isSelectableMaxDate(item + " " + day + ", " + year) || !isSelectableMinDate(item + " " + day + ", " + year)\' ng-value="$index + 1" value="$index + 1">',"{{ item }}","</option>","</select>","</div>","</div>",'<div class="_720kb-datepicker-calendar-header">','<div class="_720kb-datepicker-calendar-header-middle _720kb-datepicker-mobile-item _720kb-datepicker-calendar-month">','<select ng-model="mobileYear" title="{{ dateYearTitle }}" ng-change="setNewYear(mobileYear)">','<option ng-repeat="item in paginationYears track by $index" ng-selected="year === item" ng-disabled="!isSelectableMinYear(item) || !isSelectableMaxYear(item)" ng-value="item" value="item">',"{{ item }}","</option>","</select>","</div>","</div>"]:['<div class="_720kb-datepicker-calendar-header">','<div class="_720kb-datepicker-calendar-header-left">','<a class="_720kb-datepicker-calendar-month-button" href="javascript:void(0)" ng-class="{\'_720kb-datepicker-item-hidden\': !willPrevMonthBeSelectable()}" ng-click="prevMonth()" title="{{ buttonPrevTitle }}">',e,"</a>","</div>",'<div class="_720kb-datepicker-calendar-header-middle _720kb-datepicker-calendar-month">',"{{month}}&nbsp;",'<a href="javascript:void(0)" ng-click="paginateYears(year); showYearsPagination = !showYearsPagination;">',"<span>","{{year}}","<i ng-class=\"{'_720kb-datepicker-calendar-header-closed-pagination': !showYearsPagination, '_720kb-datepicker-calendar-header-opened-pagination': showYearsPagination}\"></i>","</span>","</a>","</div>",'<div class="_720kb-datepicker-calendar-header-right">','<a class="_720kb-datepicker-calendar-month-button" ng-class="{\'_720kb-datepicker-item-hidden\': !willNextMonthBeSelectable()}" href="javascript:void(0)" ng-click="nextMonth()" title="{{ buttonNextTitle }}">',a,"</a>","</div>","</div>"]}(e,a,n),d=function(e,a){return['<div class="_720kb-datepicker-calendar-header" ng-show="showYearsPagination">','<div class="_720kb-datepicker-calendar-years-pagination">','<a ng-class="{\'_720kb-datepicker-active\': y === year, \'_720kb-datepicker-disabled\': !isSelectableMaxYear(y) || !isSelectableMinYear(y)}" href="javascript:void(0)" ng-click="setNewYear(y)" ng-repeat="y in paginationYears track by $index">',"{{y}}","</a>","</div>",'<div class="_720kb-datepicker-calendar-years-pagination-pages">','<a href="javascript:void(0)" ng-click="paginateYears(paginationYears[0])" ng-class="{\'_720kb-datepicker-item-hidden\': paginationYearsPrevDisabled}">',e,"</a>",'<a href="javascript:void(0)" ng-click="paginateYears(paginationYears[paginationYears.length -1 ])" ng-class="{\'_720kb-datepicker-item-hidden\': paginationYearsNextDisabled}">',a,"</a>","</div>","</div>"]}(e,a),l=['<div class="_720kb-datepicker-calendar-days-header">','<div ng-repeat="d in daysInString">',"{{d}}","</div>","</div>"],c=['<div class="_720kb-datepicker-calendar-body">','<a href="javascript:void(0)" ng-repeat="px in prevMonthDays" class="_720kb-datepicker-calendar-day _720kb-datepicker-disabled">',"{{px}}","</a>","<a href=\"javascript:void(0)\" ng-repeat=\"item in days\" ng-click=\"setDatepickerDay(item)\" ng-class=\"{'_720kb-datepicker-active': selectedDay === item && selectedMonth === monthNumber && selectedYear === year, '_720kb-datepicker-disabled': !isSelectableMinDate(year + '/' + monthNumber + '/' + item ) || !isSelectableMaxDate(year + '/' + monthNumber + '/' + item) || !isSelectableDate(monthNumber, year, item) || !isSelectableDay(monthNumber, year, item),'_720kb-datepicker-today': item === today.getDate() && monthNumber === (today.getMonth() + 1) && year === today.getFullYear() && !selectedDay}\" class=\"_720kb-datepicker-calendar-day\">","{{item}}","</a>",'<a href="javascript:void(0)" ng-repeat="nx in nextMonthDays" class="_720kb-datepicker-calendar-day _720kb-datepicker-disabled">',"{{nx}}","</a>","</div>"],o=function(e){i.splice(i.length-1,0,e)};return r.forEach(o),d.forEach(o),l.forEach(o),c.forEach(o),i.join("")}(p,g,w),T=function(){N||S||!m||c.hideCalendar()},_=function(e,a){var t,n,i,r,d,l=new Date(a,e,0).getDate(),o=new Date(a+"/"+e+"/1").getDay(),s=new Date(a+"/"+e+"/"+l).getDay(),m=[],u=[];for(c.days=[],c.dateWeekStartDay=c.validateWeekDay(c.dateWeekStartDay),d=(c.dateWeekStartDay+6)%7,t=1;t<=l;t+=1)c.days.push(t);if(o===c.dateWeekStartDay)c.prevMonthDays=[];else{for(i=o-c.dateWeekStartDay,o<c.dateWeekStartDay&&(i+=7),r=1===Number(e)?12:e-1,t=1;t<=new Date(a,r,0).getDate();t+=1)m.push(t);c.prevMonthDays=m.slice(-i)}if(s===d)c.nextMonthDays=[];else{for(n=6-s+c.dateWeekStartDay,s<c.dateWeekStartDay&&(n-=7),t=1;t<=n;t+=1)u.push(t);c.nextMonthDays=u}},L=function(){c.month=r("date")(new Date(c.dateMinLimit),"MMMM"),c.monthNumber=Number(r("date")(new Date(c.dateMinLimit),"MM")),c.day=Number(r("date")(new Date(c.dateMinLimit),"dd")),c.year=Number(r("date")(new Date(c.dateMinLimit),"yyyy")),_(c.monthNumber,c.year)},$=function(){c.month=r("date")(new Date(c.dateMaxLimit),"MMMM"),c.monthNumber=Number(r("date")(new Date(c.dateMaxLimit),"MM")),c.day=Number(r("date")(new Date(c.dateMaxLimit),"dd")),c.year=Number(r("date")(new Date(c.dateMaxLimit),"yyyy")),_(c.monthNumber,c.year)},A=function(e,a){var t,n,i,r,d,l,c,o,s;for(l=0;l<x.MONTH.length;l+=1){if(o=x.MONTH[l],s=x.SHORTMONTH[l],-1!==e.indexOf(o)){e=e.replace(o,l+1);break}if(-1!==e.indexOf(s)){e=e.replace(s,l+1);break}}for(n=e.split(/\D/).filter(function(e){return e.length>0}),t=a.match(/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|MMMM|MMM|MM|M|dd?d?|yy?yy?y?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g).filter(function(e){return null!==e.match(/^[a-zA-Z]+$/i)}),l=0;l<t.length;l+=1)switch(c=t[l],!0){case-1!==c.indexOf("d"):r=n[l-(t.length-n.length)];break;case-1!==c.indexOf("M"):i=n[l-(t.length-n.length)];break;case-1!==c.indexOf("y"):d=n[l-(t.length-n.length)]}return new Date(d+"/"+i+"/"+r)},P=function(){if(!c.isSelectableMinDate(c.year+"/"+c.monthNumber+"/"+c.day)||!c.isSelectableMaxDate(c.year+"/"+c.monthNumber+"/"+c.day))return!1;var e=new Date(c.year+"/"+c.monthNumber+"/"+c.day);s.dateFormat?y.val(r("date")(e,M)):y.val(e),y.triggerHandler("input"),y.triggerHandler("change")},W={add:function(e,a){var t;e.className.indexOf(a)>-1||((t=e.className.split(" ")).push(a),e.className=t.join(" "))},remove:function(e,a){var t,n;if(-1!==e.className.indexOf(a)){for(n=e.className.split(" "),t=0;t<n.length;t+=1)if(n[t]===a){n=n.slice(0,t).concat(n.slice(t+1));break}e.className=n.join(" ")}}},E=c.$watch("dateSet",function(e){e&&!isNaN(Date.parse(e))&&(v=new Date(e),c.month=r("date")(v,"MMMM"),c.monthNumber=Number(r("date")(v,"MM")),c.day=Number(r("date")(v,"dd")),c.year=Number(r("date")(v,"yyyy")),_(c.monthNumber,c.year),"true"!==c.dateSetHidden&&P())}),H=c.$watch("dateMinLimit",function(e){e&&L()}),O=c.$watch("dateMaxLimit",function(e){e&&$()}),F=c.$watch("dateFormat",function(e){e&&P()}),j=c.$watch("dateDisabledDates",function(e){e&&(k=c.$eval(e),c.isSelectableDate(c.monthNumber,c.year,c.day)||(y.val(""),y.triggerHandler("input"),y.triggerHandler("change")))}),I=c.$watch("dateEnabledDates",function(e){e&&(f=c.$eval(e),c.isSelectableDate(c.monthNumber,c.year,c.day)||(y.val(""),y.triggerHandler("input"),y.triggerHandler("change")))});for(c.nextMonth=function(){12===c.monthNumber?(c.monthNumber=1,c.year=Number(c.year)+1):c.monthNumber+=1,c.dateMaxLimit&&(c.isSelectableMaxDate(c.year+"/"+c.monthNumber+"/"+c.days[0])||$()),c.month=r("date")(new Date(c.year,c.monthNumber-1),"MMMM"),_(c.monthNumber,c.year),c.day=void 0},c.willPrevMonthBeSelectable=function(){var e=c.monthNumber,a=c.year,t=r("date")(new Date(new Date(a+"/"+e+"/01").getTime()-864e5),"dd");return 1===e?(e=12,a-=1):e-=1,!(c.dateMinLimit&&!c.isSelectableMinDate(a+"/"+e+"/"+t))},c.willNextMonthBeSelectable=function(){var e=c.monthNumber,a=c.year;return 12===e?(e=1,a+=1):e+=1,!(c.dateMaxLimit&&!c.isSelectableMaxDate(a+"/"+e+"/01"))},c.prevMonth=function(){1===c.monthNumber?(c.monthNumber=12,c.year=Number(c.year)-1):c.monthNumber-=1,c.dateMinLimit&&(c.isSelectableMinDate(c.year+"/"+c.monthNumber+"/"+c.days[c.days.length-1])||L()),c.month=r("date")(new Date(c.year,c.monthNumber-1),"MMMM"),_(c.monthNumber,c.year),c.day=void 0},c.selectedMonthHandle=function(e){c.monthNumber=Number(r("date")(new Date(e+"/01/2000"),"MM")),_(c.monthNumber,c.year),P()},c.setNewYear=function(e){if(t||(c.day=void 0),c.dateMaxLimit&&c.year<Number(e)){if(!c.isSelectableMaxYear(e))return}else if(c.dateMinLimit&&c.year>Number(e)&&!c.isSelectableMinYear(e))return;c.paginateYears(e),c.showYearsPagination=!1,l(function(){c.year=Number(e),_(c.monthNumber,c.year)},0)},c.hideCalendar=function(){m.classList?m.classList.remove("_720kb-datepicker-open"):W.remove(m,"_720kb-datepicker-open")},c.setDatepickerDay=function(e){c.isSelectableDay(c.monthNumber,c.year,e)&&c.isSelectableDate(c.monthNumber,c.year,e)&&c.isSelectableMaxDate(c.year+"/"+c.monthNumber+"/"+e)&&c.isSelectableMinDate(c.year+"/"+c.monthNumber+"/"+e)&&(c.day=Number(e),c.selectedDay=c.day,c.selectedMonth=c.monthNumber,c.selectedYear=c.year,P(),s.hasOwnProperty("dateRefocus")&&y[0].focus(),c.hideCalendar())},c.paginateYears=function(e){var a,n=[],i=10,d=10;for(c.paginationYears=[],t&&(i=50,d=50,c.dateMinLimit&&c.dateMaxLimit&&(i=(e=new Date(c.dateMaxLimit).getFullYear())-new Date(c.dateMinLimit).getFullYear(),d=1)),a=i;a>0;a-=1)n.push(Number(e)-a);for(a=0;a<d;a+=1)n.push(Number(e)+a);"true"===c.dateTyper&&y.on("keyup blur",function(){if(y[0].value&&y[0].value.length&&y[0].value.length>0)try{(v=M?A(y[0].value.toString(),M):new Date(y[0].value.toString())).getFullYear()&&!isNaN(v.getDay())&&!isNaN(v.getMonth())&&c.isSelectableDay(v.getMonth(),v.getFullYear(),v.getDay())&&c.isSelectableDate(v.getMonth(),v.getFullYear(),v.getDay())&&c.isSelectableMaxDate(v)&&c.isSelectableMinDate(v)&&c.$apply(function(){c.month=r("date")(v,"MMMM"),c.monthNumber=Number(r("date")(v,"MM")),c.day=Number(r("date")(v,"dd")),4===v.getFullYear().toString().length&&(c.year=Number(r("date")(v,"yyyy"))),_(c.monthNumber,c.year)})}catch(e){return e}}),c.dateMaxLimit&&n&&n.length&&!c.isSelectableMaxYear(Number(n[n.length-1])+1)?c.paginationYearsNextDisabled=!0:c.paginationYearsNextDisabled=!1,c.dateMinLimit&&n&&n.length&&!c.isSelectableMinYear(Number(n[0])-1)?c.paginationYearsPrevDisabled=!0:c.paginationYearsPrevDisabled=!1,c.paginationYears=n},c.isSelectableDay=function(e,a,t){var n=0;if(D&&D.length>0)for(n;n<=D.length;n+=1)if(D[n]===new Date(e+"/"+t+"/"+a).getDay())return!1;return!0},c.isSelectableDate=function(e,a,t){var n=0;if(k&&k.length>0)for(n;n<=k.length;n+=1)if(new Date(k[n]).getTime()===new Date(e+"/"+t+"/"+a).getTime())return!1;if(f){for(n;n<=f.length;n+=1)if(new Date(f[n]).getTime()===new Date(e+"/"+t+"/"+a).getTime())return!0;return!1}return!0},c.isSelectableMinDate=function(e){return!(c.dateMinLimit&&new Date(c.dateMinLimit)&&new Date(e).getTime()<new Date(c.dateMinLimit).getTime())},c.isSelectableMaxDate=function(e){return!(c.dateMaxLimit&&new Date(c.dateMaxLimit)&&new Date(e).getTime()>new Date(c.dateMaxLimit).getTime())},c.isSelectableMaxYear=function(e){return!(c.dateMaxLimit&&e>new Date(c.dateMaxLimit).getFullYear())},c.isSelectableMinYear=function(e){return!(c.dateMinLimit&&e<new Date(c.dateMinLimit).getFullYear())},c.validateWeekDay=function(e){var a=Number(e,10);return(!a||a<0||a>6)&&(a=0),a},Y=Y.replace(/{{/g,d.startSymbol()).replace(/}}/g,d.endSymbol()),c.dateMonthTitle=c.dateMonthTitle||"Select month",c.dateYearTitle=c.dateYearTitle||"Select year",c.buttonNextTitle=c.buttonNextTitle||"Next",c.buttonPrevTitle=c.buttonPrevTitle||"Prev",c.month=r("date")(v,"MMMM"),c.monthNumber=Number(r("date")(v,"MM")),c.day=Number(r("date")(v,"dd")),c.dateWeekStartDay=c.validateWeekDay(c.dateWeekStartDay),c.dateMaxLimit?c.year=Number(r("date")(new Date(c.dateMaxLimit),"yyyy")):c.year=Number(r("date")(v,"yyyy")),c.months=x.MONTH,c.daysInString=[],b=c.dateWeekStartDay;b<=c.dateWeekStartDay+6;b+=1)c.daysInString.push(b%7);c.daysInString=c.daysInString.map(function(e){return r("date")(new Date(new Date("06/08/2014").valueOf()+864e5*e),"EEE")}),c.datepickerAppendTo&&-1!==c.datepickerAppendTo.indexOf(".")?(c.datepickerID="datepicker-id-"+(new Date).getTime()+(Math.floor(6*Math.random())+8),e.element(document.getElementsByClassName(c.datepickerAppendTo.replace(".",""))[0]).append(n(e.element(Y))(c,function(a){m=e.element(a)[0]}))):c.datepickerAppendTo&&-1!==c.datepickerAppendTo.indexOf("#")?(c.datepickerID="datepicker-id-"+(new Date).getTime()+(Math.floor(6*Math.random())+8),e.element(document.getElementById(c.datepickerAppendTo.replace("#",""))).append(n(e.element(Y))(c,function(a){m=e.element(a)[0]}))):c.datepickerAppendTo&&"body"===c.datepickerAppendTo?(c.datepickerID="datepicker-id-"+((new Date).getTime()+(Math.floor(6*Math.random())+8)),e.element(document).find("body").append(n(e.element(Y))(c,function(a){m=e.element(a)[0]}))):(y.after(n(e.element(Y))(c)),m=o[0].querySelector("._720kb-datepicker-calendar")),c.datepickerToggle&&!c.$eval(c.datepickerToggle)||y.on("focus click focusin",function(){S=!0,N||S||!m?(u=a.document.getElementsByClassName("_720kb-datepicker-calendar"),e.forEach(u,function(e,a){u[a].classList?u[a].classList.remove("_720kb-datepicker-open"):W.remove(u[a],"_720kb-datepicker-open")}),m.classList?(m.classList.add("_720kb-datepicker-open"),v=M?A(y[0].value.toString(),M):new Date(y[0].value.toString()),c.selectedMonth=Number(r("date")(v,"MM")),c.selectedDay=Number(r("date")(v,"dd")),c.selectedYear=Number(r("date")(v,"yyyy"))):W.add(m,"_720kb-datepicker-open"),c.today=new Date,l(function(){c.selectedDay?(c.year=c.selectedYear,c.monthNumber=c.selectedMonth):(c.year=c.today.getFullYear(),c.monthNumber=c.today.getMonth()+1),c.month=r("date")(new Date(c.year,c.monthNumber-1),"MMMM"),_(c.monthNumber,c.year)},0)):c.hideCalendar()}),y.on("focusout blur",function(){S=!1}),e.element(m).on("mouseenter",function(){N=!0}),e.element(m).on("mouseleave",function(){N=!1}),e.element(m).on("focusin",function(){N=!0}),e.element(a).on("click focus focusin",T),(c.dateMinLimit&&!c.isSelectableMinYear(c.year)||!c.isSelectableMinDate(c.year+"/"+c.monthNumber+"/"+c.day))&&L(),(c.dateMaxLimit&&!c.isSelectableMaxYear(c.year)||!c.isSelectableMaxDate(c.year+"/"+c.monthNumber+"/"+c.day))&&$(),c.paginateYears(c.year),_(c.monthNumber,c.year),c.checkVisibility=function(){return!!c.datepickerShow&&(v=M?A(y[0].value.toString(),M):new Date(y[0].value.toString()),c.selectedMonth=Number(r("date")(v,"MM")),c.selectedDay=Number(r("date")(v,"dd")),c.selectedYear=Number(r("date")(v,"yyyy")),c.$eval(c.datepickerShow))},c.$on("$destroy",function(){E(),H(),O(),F(),j(),I(),y.off("focus click focusout blur"),e.element(m).off("mouseenter mouseleave focusin"),e.element(a).off("click focus focusin",T)})}}}])}(angular,navigator);