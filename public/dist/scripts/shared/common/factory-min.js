function TokenInterceptor(e,o,n,r,t){return{request:function(e){return e.headers=e.headers||{},o.sessionStorage.authToken&&(e.headers.Authorization=o.sessionStorage.authToken),e},responseError:function(r){t.get("accessToken"),t.get("$http"),t.get("$helpers");if(401==r.status||-1==r.status){if(r.config.url!=n.appConfig.customerBaseUrl+n.appConfig.logError){o.sessionStorage.APIstatus=401;var s=r.config.url.split("/");"getnewaccesstoken"==s[s.length-1]&&(o.sessionStorage.refreshToken=null,o.sessionStorage.authToken=null,o.location="#/login")}}return r.status,r.status,e.reject(r)},response:function(n){return o.sessionStorage.APIstatus=!1,n||e.when(n)}}}function accessToken(e,o,n,r,t,s){var a={},i=n.get("exceptionService");return a.getToken=function(){var n=t.defer();if("accessToken"==s.sessionStorage.tokenAPI){var r=o.appConfig.customerBaseUrl+o.appConfig.getNewAccessToken,a={userName:s.sessionStorage.username||"",refreshToken:s.sessionStorage.refreshToken||null};o.newTokenCalled=!0}else{var r=o.appConfig.customerBaseUrl+o.appConfig.getAccessToken,a={userName:s.sessionStorage.username||""};s.sessionStorage.tokenAPI="accessToken"}return e.post(r,a).then(function(e){e.success?(s.sessionStorage.authToken=e.accessToken,e.refreshToken&&(s.sessionStorage.refreshToken=e.refreshToken),n.resolve()):(i.promiseRejectsAfterAWhile(e),n.reject())},function(e,o){"newAccessToken"==s.sessionStorage.tokenAPI&&(s.sessionStorage.tokenAPI=null,s.sessionStorage.refreshToken=null,s.sessionStorage.authToken=null,s.location="#/login"),null!=e||(e={}),e.status=o,i.promiseRejectsAfterAWhile(e),n.reject()}).finally(function(){}),n.promise},a}function modalFactory(e){var o={};return o.errorModal=function(o){return e.open({animation:!0,templateUrl:"modal-skeleton.html",controller:"modalInstanceController",backdrop:"static",keyboard:!1,resolve:{params:function(){return o}}})},o.gridModal=function(o){return e.open({animation:!0,templateUrl:"modal-grid-skeleton.html",controller:"gridModalInstanceController",backdrop:"static",keyboard:!1,resolve:{params:function(){return o}}})},o}function exceptionService(e,o,n){return{throwsAnError:function(e){throw new Error(e)},promiseRejectsAfterAWhile:function(o){var r=e.defer();return n(function(){r.reject(o)},500),r.promise}}}function fantumnAlert(e){var o={};return o.open=function(o,n,r,t,s,a,i,c){e.open({animation:!0,templateUrl:o,controller:"alertModalContentCtrl",windowClass:"common-alertpopups",size:c,backdrop:"static",resolve:{alert_model:function(){return{alert_header:n,alert_message:r,isdelete:t,entity:s,viewId:a,isremove:i}}}})},o}angular.module("fantumn").factory("TokenInterceptor",TokenInterceptor).factory("modalFactory",modalFactory).factory("exceptionService",exceptionService).factory("accessToken",accessToken).factory("fantumnAlert",fantumnAlert);